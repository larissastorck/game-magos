<!doctype html>
<html>

<head>
    <meta charset="utf-8">
    <title>Hello World</title>
    <script src="/library/bump/bin/bump.js"></script>
    <script src="/scripts/keyboard.js"></script>
    <script src="/scripts/stage-boundaries.js"></script>
    <style>
        * {
            padding-top: 5px;
            padding-left: 100px;
            margin: auto;
        }
    </style>
</head>
<script src="pixi/pixi.min.js"></script>

<body>
    <script type="text/javascript">

        //Aliases
        let Application = PIXI.Application,
            loader = PIXI.loader,
            resources = PIXI.loader.resources,
            Sprite = PIXI.Sprite,
            TextStyle = PIXI.TextStyle;
        Texture = PIXI.Texture;

        const WIDTH = 800;
        const HEIGHT = 600;

        //create pixi Application
        let app = new Application({
            width: WIDTH,         // default: 800
            height: HEIGHT,        // default: 600
            antialias: true,    // default: false
            transparent: false, // default: false
            resolution: 1       // default: 1
        });

        app.renderer.backgroundColor = 0x061639;
        document.body.appendChild(app.view);


        loader
            .add("sprites/wizard/good-wizard-idle-right.png")
            .add("sprites/wizard/evil-wizard-idle-right.png")
            .add("sprites/stones/earth-gem.png")
            .add("sprites/stones/fire-gem.png")
            .add("sprites/stones/water-gem.png")
            .load(setup);

        let bump = new Bump(PIXI);

        let wizard;
        let fireWizard;
        let waterWizard;
        let earthWizard;

        let wizardEvil;

        let state;
        let earthGem;
        let fireGem;
        let waterGem;
        const speed = 5;


        function setup() {

            wizard = new Sprite(resources["sprites/wizard/good-wizard-idle-right.png"].texture);
            fireWizard = Texture.fromImage('sprites/wizard/good-wizard-fire-right.png');
            waterWizard = Texture.fromImage('sprites/wizard/good-wizard-water-right.png');
            earthWizard = Texture.fromImage('sprites/wizard/good-wizard-earth-right.png');

            wizardEvil = new Sprite(resources["sprites/wizard/evil-wizard-idle-right.png"].texture);
            earthGem = new Sprite(resources["sprites/stones/earth-gem.png"].texture);
            fireGem = new Sprite(resources["sprites/stones/fire-gem.png"].texture);
            waterGem = new Sprite(resources["sprites/stones/water-gem.png"].texture);



            let wizardY = wizard.height / 2;
            let wizardX = wizard.width / 2;

            wizard.vx = 0;
            wizard.vy = 0;

            wizard.anchor.set(0.5);
            wizard.position.set(wizardX, app.view.height / 2);

            wizardEvil.anchor.set(0.5);
            wizardEvil.position.set(wizardX, app.view.height / 2 + wizardY + 50);

            earthGem.anchor.set(0.5);
            earthGem.position.set(app.view.width / 2, app.view.height / 2);

            fireGem.anchor.set(0.5);
            fireGem.position.set(app.view.width / 2, app.view.height / 2 + fireGem.height);

            waterGem.anchor.set(0.5);
            waterGem.position.set(app.view.width / 2, app.view.height / 2 + waterGem.height * -1);

            app.stage.addChild(wizard);
            app.stage.addChild(wizardEvil);
            app.stage.addChild(earthGem);
            app.stage.addChild(fireGem);
            app.stage.addChild(waterGem);

            //Capture the keyboard arrow keys
            left = keyboard(37),
                up = keyboard(38),
                right = keyboard(39),
                down = keyboard(40);

            left.press = () => {
                //Change the wizard's velocity when the key is pressed
                wizard.vx = -speed;
                wizard.vy = 0;
            };

            //Left arrow key `release` method
            left.release = () => {
                //If the left arrow has been released, and the right arrow isn't down,
                //and the wizard isn't moving vertically:
                //Stop the wizard
                if (!right.isDown && wizard.vy === 0) {
                    wizard.vx = 0;
                }
            };

            //Up
            up.press = () => {
                wizard.vy = -speed;
                wizard.vx = 0;
            };
            up.release = () => {
                if (!down.isDown && wizard.vx === 0) {
                    wizard.vy = 0;
                }
            };

            //Right
            right.press = () => {
                wizard.vx = speed;
                wizard.vy = 0;
            };
            right.release = () => {
                if (!left.isDown && wizard.vy === 0) {
                    wizard.vx = 0;
                }
            };

            //Down
            down.press = () => {
                wizard.vy = speed;
                wizard.vx = 0;
            };
            down.release = () => {
                if (!up.isDown && wizard.vx === 0) {
                    wizard.vy = 0;
                }
            };

            //set the game state
            state = play;

            //start the game loop
            app.ticker.add(delta => gameLoop(delta));
        }

        function gameLoop(delta) {
            state(delta);
        }

        function removeSpriteAndGenerateInRandomPlace(mySprite) {
            app.stage.removeChild(mySprite);
            mySprite.position.set(getRandomInt(50, 700), getRandomInt(50, 700));
            app.stage.addChild(mySprite);
        }

        function getRandomInt(min, max) {
            min = Math.ceil(min);
            max = Math.floor(max);
            return Math.floor(Math.random() * (max - min)) + min;
        }


        function play(delta) {
            wizard.x += wizard.vx;
            wizard.y += wizard.vy;

            console.log("wizard.x ", wizard.x);
            console.log("container.x ", app.stage.x);
            //contain(wizard,  {x: wizard.width/2, y: wizard.height/2, width: WIDTH, height: HEIGHT});
            
            contain(wizard,  {width: WIDTH, height: HEIGHT});
            //contain(wizardEvil, app.stage);
            //check for collision
            if (bump.hit(wizard, wizardEvil)) {
                //nada
            } else {
                //nada
            }

            if (bump.hit(wizard, fireGem)) {
                wizard.texture = fireWizard;
                removeSpriteAndGenerateInRandomPlace(fireGem);
            } else if (bump.hit(wizard, waterGem)) {
                wizard.texture = waterWizard;
                removeSpriteAndGenerateInRandomPlace(waterGem);
            } else if (bump.hit(wizard, earthGem)) {
                wizard.texture = earthWizard;
                removeSpriteAndGenerateInRandomPlace(earthGem);
            }
        }

    </script>
</body>

</html>
